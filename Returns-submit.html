<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>C - Return | Lodge a Return</title>
<style>
  :root{
    --brand:#10b981;
    --brand-600:#059669;
    --brand-700:#047857;
    --accent:#f59e0b;
    --bg:#f5f7fb;
    --panel:#ffffff;
    --border:#e5e9f2;
    --text:#0f172a;
    --muted:#64748b;
    --radius:14px;
    --shadow:0 6px 18px rgba(9,16,35,.08);
  }
  *{box-sizing:border-box}
  body{margin:0; font:15px/1.4 Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial; background:var(--bg); color:var(--text)}
  .brandbar{
    background:linear-gradient(90deg, var(--brand) 0%, #15c28f 35%, #16dfa3 65%, #12c2b3 100%);
    color:#fff; box-shadow:var(--shadow);
  }
  .brandbar-inner{padding:12px 16px; display:flex; justify-content:space-between; align-items:center}
  .brand{display:flex; align-items:center; gap:10px; font-weight:800; font-size:18px}
  .brand .mark{width:28px; height:28px; border-radius:6px; background:#fff; color:var(--brand); display:grid; place-items:center; font-weight:900}
  .container{max-width:800px; margin:24px auto; background:var(--panel); padding:24px; border-radius:var(--radius); box-shadow:var(--shadow)}
  h1{margin:0 0 20px; font-size:24px}
  label{display:block; margin-top:16px; margin-bottom:6px; font-weight:600; font-size:14px; color:var(--text)}
  input,textarea,select{
    width:100%; padding:10px 12px; border-radius:10px; border:1px solid var(--border); font-size:14px; color:var(--text); background:#fff;
  }
  input:focus,textarea:focus,select:focus{border-color:var(--brand); outline:none; box-shadow:0 0 0 3px rgba(16,185,129,.18)}
  textarea{resize:vertical; min-height:80px}
  .dropzone{margin-top:10px; border:2px dashed #b6ebd4; border-radius:10px; padding:20px; text-align:center; color:var(--muted); cursor:pointer; background:#f5fffa; transition:.2s}
  .dropzone.drag{background:#eafff4; border-color:#68d3a8}
  .agreement{margin-top:20px; display:flex; align-items:center; gap:8px; font-size:14px; color:var(--muted)}
  .btn{margin-top:24px; padding:12px 20px; font-size:16px; font-weight:700; border:none; border-radius:10px; cursor:pointer; background:var(--brand); color:#fff; box-shadow:var(--shadow)}
  .btn:hover{background:var(--brand-600)}
  .toast{position:fixed; right:16px; bottom:16px; background:#0b1220; color:#fff; padding:12px 16px; border-radius:10px; box-shadow:var(--shadow); opacity:0; transform:translateY(8px); transition:.3s}
  .toast.show{opacity:1; transform:translateY(0)}

  /* --- Stage bubbles --- */
.stage{
  background:var(--panel);
  border:1px solid var(--border);
  border-radius:var(--radius);
  box-shadow:var(--shadow);
  margin:14px 0;
  overflow:clip;
}
.stage>summary{
  list-style:none; cursor:pointer; user-select:none;
  padding:12px 14px; display:flex; align-items:center; gap:10px;
  background:linear-gradient(180deg,#ffffff,#f9fbff);
  border-bottom:1px solid var(--border);
}
.stage[open]>summary{
  background:linear-gradient(180deg,#f9fffc,#ffffff);
  border-bottom-color:#bfe8d6;
  box-shadow:inset 0 -1px 0 rgba(16,185,129,.18);
}
.stage-pill{
  font-weight:800; font-size:12px; padding:6px 10px; border-radius:999px;
  background:#eef2ff; color:#1e293b; border:1px solid #dbe3f0;
}
.stage[open] .stage-pill{ background:#ecfdf5; color:#065f46; border-color:#bfe8d6; }
.stage-title{ font-weight:800; color:#0f172a; }
.stage-status{ margin-left:auto; font-size:12px; font-weight:700; color:var(--muted); }
.stage-body{ padding:14px; }

/* Agreement outside the bubble — force left-aligned, full-width layout */
.container .agreement {
  display: grid;                /* checkbox | text */
  grid-template-columns: auto 1fr;
  align-items: start;
  gap: 10px;
  margin-top: 18px;
  padding: 14px 0;
  border-top: 1px solid var(--border);
  width: 100%;
}

.container .agreement input[type="checkbox"] {
  margin: 4px 0 0;              /* align with first line of text */
  justify-self: start;
  flex: none;
}

.container .agreement label {
  margin: 0;
  text-align: left;
  line-height: 1.6;
  color: var(--text);
  font-size: 14px;
}

/* === Two-column layout === */
.layout{
  max-width: 1200px;          /* wider than the old 800px to allow a sidebar */
  margin: 24px auto;
  display: grid;
  grid-template-columns: 260px 1fr;
  gap: 18px;
}

/* Sidebar */
.sidebar{
  background: var(--panel);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  box-shadow: var(--shadow);
  padding: 12px;
  align-self: start;
}

.sb-head{
  font-weight: 800;
  color: var(--text);
  padding: 8px 10px 12px;
  border-bottom: 1px solid var(--border);
}

.sb-nav{ display:flex; flex-direction:column; padding: 8px 4px; }

.sb-item{
  appearance:none; border:1px solid var(--border);
  background:#fff; color:var(--text);
  border-radius: 12px;
  padding: 10px 12px;
  margin: 6px 6px;
  display:grid;
  grid-template-columns: 22px 1fr auto;
  gap:10px; align-items:center;
  cursor:pointer; font-weight:700;
  box-shadow: 0 2px 6px rgba(2,6,23,.05);
  transition: border .15s, box-shadow .15s, transform .05s;
}
.sb-item:hover{ border-color:#cfe9df; box-shadow:0 4px 12px rgba(16,185,129,.12); }
.sb-item:active{ transform: translateY(1px); }

.sb-item.active{
  background: linear-gradient(180deg,#ffffff,#f6fff9);
  border-color: #b6ebd4;
  box-shadow: 0 4px 12px rgba(16,185,129,.16);
}
.sb-item.active .go{ color: var(--brand); font-weight:900; }

.sb-ico{ display:inline-grid; place-items:center; color: var(--brand-700); }
.sb-item.active .sb-ico{ color: var(--brand); }

.chev{ color:#64748b; font-size:12px; }
.go{ color:#0f172a; font-size:18px; line-height:1; }

/* Make the main .container stretch nicely next to the sidebar */
.layout > .container{
  margin: 0;                   /* remove the old auto margins */
  width: 100%;                 /* full width of grid column */
}

/* Responsive: stack on small screens */
@media (max-width: 980px){
  .layout{ grid-template-columns: 1fr; }
  .sidebar{ order: -1; }       /* sidebar above content on mobile */
}

.danger-text { color:#b91c1c; font-size:14px; }
.danger-link { color:#b91c1c; text-decoration:underline; }

/* Step 4 agreements (two tidy rows) */
.agreement-list{
  display: grid;
  gap: 10px;
  padding: 10px 14px 0;     /* no top border line */
  border-top: none;         /* remove the grey line */
}

.agree{
  display: grid;
  grid-template-columns: 18px 1fr; /* checkbox | text */
  align-items: start;
  gap: 10px;
  margin: 6px 0;                /* <— adds vertical space between each checkbox */
  padding: 6px 0;               /* <— adds white space above/below text */
}

.agree input[type="checkbox"] {
  margin-top: 4px;
}

.agree span {
  line-height: 1.7;
  color: var(--text);
  font-size: 14px;
}

.link-inline {
  color: var(--brand);
  font-weight: 700;
  text-decoration: none;
}

.link-inline:hover {
  text-decoration: underline;
}

.phone-upload-row{ margin-top:10px; }
.btn.outline{
  appearance:none;border:1px solid var(--border);background:#fff;color:#065f46;
  font-weight:800;padding:8px 12px;border-radius:10px;cursor:pointer;
}
.btn.sm{ padding:6px 10px; border-radius:8px; }
.qr-wrap{ display:flex; gap:16px; align-items:center; }
#qrBox{ width:140px; height:140px; padding:8px; background:#fff; border:1px solid var(--border); border-radius:10px; }
.qr-info{ flex:1; }
.link-row{ display:flex; gap:8px; align-items:center; margin:8px 0; }
.link-row input{ flex:1; border:1px solid var(--border); border-radius:8px; padding:8px 10px; background:#f8fafc; }
.mono{ font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; }
.small{ font-size:13px; }
.tiny{ font-size:12px; }

/* Phone upload sheet */
.qr-sheet{
  margin-top: 10px;
  border: 1px solid var(--border);
  border-radius: 14px;
  background: #fff;
  box-shadow: var(--shadow);
  padding: 16px;
  display: grid;
  grid-template-columns: 148px 1fr; /* QR | details */
  gap: 16px;
}
.qr-left{ display:flex; align-items:center; justify-content:center }
.qr-box{
  width:140px;height:140px;padding:8px;background:#fff;border:1px solid var(--border);
  border-radius:12px; display:flex;align-items:center;justify-content:center;
}
.qr-right{ display:flex; flex-direction:column; gap:10px }
.qr-title{ margin:0; font-size:16px; font-weight:500 }
.qr-sub{ margin:0; color:var(--muted) }

.qr-row{ display:flex; align-items:center; gap:10px }
.code-label{ color:#475569; font-weight:800 }
.code-pill{
  display:inline-block; padding:4px 10px; border-radius:999px; font-weight:800; font-size:12px;
  background:#ecfdf5; color:#047857; border:1px solid #a7f3d0; white-space:nowrap;
}

.url-group{ display:flex; gap:8px; align-items:center }
.url-input{
  flex:1; padding:8px 10px; border:1px solid var(--border); border-radius:10px;
  background:#f8fafc; overflow:hidden; text-overflow:ellipsis;
}
.btn.copy{
  appearance:none; border:1px solid var(--brand); background:var(--brand);
  color:#fff; font-weight:800; padding:8px 12px; border-radius:10px; cursor:pointer;
}
.btn.copy:hover{ background:var(--brand-700) }

.qr-meta{ font-size:12px; color:var(--muted) }
.qr-actions{ margin-top:2px }

/* Trigger button style */
.btn.outline{
  appearance:none;border:1px solid var(--border);background:#fff;color:#065f46;
  font-weight:800;padding:8px 12px;border-radius:10px;cursor:pointer;
}
.btn.outline:hover{ border-color:#b6ebd4; box-shadow:0 3px 10px rgba(16,185,129,.12) }

/* Small monospace helper */
.mono{ font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace }

/* Uploaded files panel */
.uploaded-panel{
  margin-top:14px; background:#fff; border:1px solid var(--border,#e5e7eb);
  border-radius:12px; padding:12px; box-shadow:0 6px 18px rgba(2,6,23,.04);
}

.uploaded-title{ font-weight:700; }
.uploaded-count{ color:#64748b; font-weight:600; margin-left:6px; }

/* Grid of thumbnails */
#uploadedList,
.up-grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(140px,1fr));
  gap:10px; margin-top:10px;
}

.up-card{
  border:1px solid var(--border,#e5e7eb);
  border-radius:10px; overflow:hidden; background:#fff;
  display:flex; flex-direction:column;
}

/* Fixed preview area with crop */
.up-preview{
  aspect-ratio:4/3;                  /* keeps all thumbs same shape */
  display:grid; place-items:center;
  background:#f8fafc; text-decoration:none; color:#0f172a;
}
.up-preview img{
  width:100%; height:100%;
  object-fit:cover; display:block;   /* <- do not stretch, crop to fill */
}

/* Meta row */
.up-meta{
  padding:8px 10px; display:flex; align-items:center;
  justify-content:space-between; gap:6px;
}
.up-name{
  font-size:12px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
}
.icon-btn{
  border:1px solid var(--border,#e5e7eb); background:#fff;
  border-radius:8px; padding:4px 6px; cursor:pointer;
}
.icon-btn:hover{ background:#f3f4f6; }

/* Safety net if an <img> is appended without wrapper */
#uploadedList > img{
  width:140px; height:105px;         /* 4:3 */
  object-fit:cover; border:1px solid var(--border,#e5e7eb);
  border-radius:10px; display:block;
}

.section-title {
  font-size: 16px;
  font-weight: 700;
  color: #0f172a;
  margin: 20px 0 10px 0;
  padding-left: 2px;
  border-left: 4px solid var(--brand);
  padding-inline-start: 10px;
  line-height: 1.4;
}

#fault {
  min-height: 400px;  /* default height */
  resize: vertical;   /* allows user to resize only vertically */
  width: 100%;        /* ensures it spans the full container */
  font-size: 14px;
  line-height: 1.5;
  padding: 10px 12px;
  border: 1px solid var(--border);
  border-radius: 8px;
  background: #fff;
}

.lockable[readonly],
.lockable:disabled {
  background:#f8fafc;
  color:#64748b;
  border-color:#e2e8f0;
  pointer-events:none;            /* ignore clicks */
}

.lockable[readonly]::placeholder { color:#94a3b8; }

/* optional lock icon */
.lockable[readonly],
.lockable:disabled {
  background-image:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="%2394a3b8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>');
  background-repeat:no-repeat;
  background-position:right 12px center;
  background-size:18px;
  padding-right:40px;
}

.return-method { margin-top:16px; }

.return-method h3{
  margin:0 0 10px;
  font-size:16px;
  font-weight:500;
  color:#0f172a;
}

/* Option row */
.rm-option{
  display:grid;
  grid-template-columns: 28px 1fr;
  align-items:start;
  gap:12px;
  padding:16px 18px;
  border:1px solid var(--border);
  border-radius:12px;
  background:#f8fafc;
  transition: background .15s, border-color .15s;
  cursor:pointer;
  margin-bottom:10px;
}

.rm-option:hover{ background:#f1f5f9; }

.rm-option input[type="radio"]{
  margin-top:3px; /* aligns circle with heading */
  transform: scale(1.15);
}

.rm-content{ display:block; }

.rm-title h4{
  margin:0;
  font-size:16px;
  color:#0f172a;
}
.rm-title p{
  margin:4px 0 0;
  font-size:13px;
  color:#64748b;
}

/* Selected state */
.rm-option.is-selected{
  background:#ecfdf5;
  border-color:#bbf7d0;            /* soft mint ring */
}

/* Details block directly under option, indented to content column */
.rm-details{
  margin-left: 28px + 12px;        /* radio col + gap = 40px; most preprocessors allow calc() */
  margin-left: 40px;               /* plain CSS fallback */
  margin-top: -2px;
  margin-bottom: 12px;
}

.rm-card{
  display:grid;
  grid-template-columns: repeat(auto-fit, minmax(220px,1fr));
  gap:16px;
  padding:14px;
  background:#fff;
  border:1px solid var(--border);
  border-radius:12px;
  box-shadow: 0 4px 14px rgba(2,6,23,.06);
}

.rm-card h5{
  margin:0 0 6px;
  font-size:14px;
  color:#0f172a;
}

.rm-card ul{
  margin:0; padding-left:16px;
  font-size:13px; color:#475569;
}

.rm-card select,
.rm-card input[type="date"]{
  width:100%;
  margin-top:6px;
  padding:9px 10px;
  border:1px solid var(--border);
  border-radius:10px;
  font-size:14px;
  background:#f9fafb;
}

</style>
</head>
<body>

  <!-- Brand bar -->
  <div class="brandbar">
    <div class="brandbar-inner">
      <div class="brand">
        <div class="mark">C</div>
        <div>- Returns</div>
      </div>
      <div class="brand" style="gap:6px">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2"><circle cx="12" cy="12" r="9"/><path d="M12 7v6l4 2"/></svg>
        <div style="font-weight:700">Fast, fair & friendly</div>
      </div>
    </div>
</div>

<!-- LAYOUT: sidebar + main -->
<div class="layout">
  <!-- Sidebar -->
  <aside class="sidebar" role="navigation" aria-label="Account menu">
    <div class="sb-head">Account</div>

    <nav class="sb-nav">
      <button class="sb-item" data-link="/account/orders">
        <span class="sb-ico">
          <!-- cart -->
          <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2"><circle cx="9" cy="21" r="1"/><circle cx="20" cy="21" r="1"/><path d="M1 1h4l2.68 12.39a2 2 0 0 0 2 1.61h7.72a2 2 0 0 0 2-1.61L23 6H6"/></svg>
        </span>
        <span>Your Orders</span>
        <span class="chev">▾</span>
      </button>

      <button class="sb-item" data-link="/account/details">
        <span class="sb-ico">
          <!-- doc -->
          <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><path d="M14 2v6h6"/></svg>
        </span>
        <span>Your Details</span>
        <span class="chev">▾</span>
      </button>

      <button class="sb-item" data-link="/account/membership">
        <span class="sb-ico">
          <!-- group -->
          <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2"><path d="M16 11c1.66 0 3-1.57 3-3.5S17.66 4 16 4s-3 1.57-3 3.5 1.34 3.5 3 3.5Z"/><path d="M2 20v-1a4 4 0 0 1 4-4h6"/><path d="M9 11c1.66 0 3-1.57 3-3.5S10.66 4 9 4 6 5.57 6 7.5 7.34 11 9 11Z"/></svg>
        </span>
        <span>Membership</span>
        <span class="chev">▾</span>
      </button>

      <button class="sb-item" data-link="/account/wishlist">
        <span class="sb-ico">
          <!-- heart -->
          <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2"><path d="M20.8 4.6a5.5 5.5 0 0 0-7.8 0L12 5.6l-1-1a5.5 5.5 0 0 0-7.8 7.8l1 1L12 22l7.8-7.6 1-1a5.5 5.5 0 0 0 0-7.8Z"/></svg>
        </span>
        <span>Wishlist</span>
        <span class="chev">▾</span>
      </button>

      <!-- Active page -->
      <button class="sb-item active" data-link="Returns-landing.html">
        <span class="sb-ico">
          <!-- shield -->
          <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
        </span>
        <span>Returns</span>
        <span class="go">›</span>
      </button>

      <button class="sb-item" data-link="index.html">
        <span class="sb-ico">
          <!-- logout -->
          <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><path d="m16 17 5-5-5-5"/><path d="M21 12H9"/></svg>
        </span>
        <span>Log out</span>
      </button>
    </nav>
  </aside>

  <!-- Main content (keep your existing container + form inside) -->

<div class="container">
  <h1>Submit a Return Request</h1>
  <form id="returnForm">
<details class="stage" open>
  <summary>
    <span class="stage-pill">Step 1</span>
    <span class="stage-title">Select return type</span>
    <span class="stage-status" id="s1Status">Required</span>
  </summary>
  <div class="stage-body">
    <label for="returnType">Return type</label>
    <select id="returnType" name="returnType" required>
      <option value="" disabled selected>Select a return type…</option>
      <option value="faulty">Faulty product (warranty/DOA)</option>
      <option value="other">Something else (change of mind, wrong item, etc.)</option>
    </select>
<p id="returnWarning" class="danger-text" style="display:none; margin-top:6px;">
  Please note: Change-of-mind and incorrect-item returns are subject to Centre Com’s 
  <a href="#" class="danger-link">Terms & Conditions</a>. Products must be unopened, in original
  packaging, and returned within 7 days of purchase.
</p>

  </div>
</details>

    <!-- Product details -->

<!-- Stage 2: Product details -->

<details class="stage" open>
  <summary>
    <span class="stage-pill">Step 2</span>
    <span class="stage-title">Product details</span>
    <span class="stage-status" id="s2Status">Complete</span>
  </summary>
  <div class="stage-body">
    <label for="serial">Serial Number</label>
    <div style="display:flex; gap:8px">
      <input id="serial" name="serial" value="SN4070-88121" readonly aria-readonly="true" class="lockable" />
    </div>

    <label for="product" style="margin-top:14px">Product Description</label>
    <input id="product" name="product" value="GeForce RTX 4070 Ventus 12GB" readonly aria-readonly="true" class="lockable" />
    <label for="sku">SKU</label>

    <input id="sku" name="sku" value="GPU-4070-MSI" readonly aria-readonly="true" class="lockable" />
    <label for="invoice">Invoice Number</label>

    <input id="invoice" name="invoice" value="ORD-41235" readonly aria-readonly="true" class="lockable" />

    <label for="date">Date of Purchase</label>

    <input type="date" id="date" name="date" value="2025-04-02" readonly aria-readonly="true" class="lockable" />

  </div>
</details>

<details class="stage" open>
  <summary>
    <span class="stage-pill">Step 3</span>
    <span class="stage-title">Tell us about the issue</span>
    <span class="stage-status" id="s3Status">Required</span>
  </summary>
  <div class="stage-body">
  <div class="section-title">Describe the fault/ problem with the product</div>
    <textarea id="fault" name="fault" required
      placeholder="What happens, when, any codes/artifacts, tests tried…"></textarea>

<!-- Uploaded files panel -->
<div class="section-title">Do you have any photos or video which highlight the issue with the product?</div>
<div class="uploaded-panel">
  <div class="up-head">
    <span>Uploaded files</span> <span id="upCount" class="muted">(0)</span>
  </div>
  <div id="uploadedGrid" class="up-grid"></div>
</div>

    <div id="drop" class="dropzone">Drag & drop files here or click to select</div>
    <div id="fileList" style="margin-top:10px;font-size:14px;color:var(--muted)"></div>

    <!-- action row under your drop zone -->
<div class="phone-upload-row">
  <button type="button" class="btn outline" id="phoneUploadBtn">Upload from your phone</button>
</div>

<!-- Phone upload sheet (inline) -->
<section id="phoneSheet" class="qr-sheet" hidden>
  <div class="qr-left">
    <div id="qrBox" class="qr-box"></div>
  </div>

  <div class="qr-right">
    <h4 class="qr-title">Upload from your phone</h4>
    <p class="qr-sub">Scan this QR code with your phone to open a secure page and select photos/videos.</p>

    <div class="qr-row">
      <span class="code-label">Session code</span>
      <span class="code-pill" id="qrCodeText">—</span>
    </div>

    <div class="url-group">
      <input id="qrLink" class="mono url-input" readonly />
      <button type="button" class="btn copy" id="copyLinkBtn">Copy</button>
    </div>

    <div class="qr-meta">
      <span class="muted">Expires in <strong id="qrExpiry">5m</strong></span>
    </div>

  </div>
</section>

  </div>
</details>

<details class="stage" open>
  <summary>
    <span class="stage-pill">Step 4</span>
    <span class="stage-title">How would you like to return this item?</span>
    <span class="stage-status" id="s4Status">Required</span>
  </summary>
 <div class="section-title">Choose a return method</div>

<section class="return-method">

  <!-- Option 1 -->
  <label class="rm-option" data-option="post">
    <input type="radio" name="returnMethod" value="post" checked>
    <div class="rm-content">
      <div class="rm-title">
        <h4>Post it back (free prepaid label)</h4>
        <p>We’ll generate a label after you submit and we approve the return.</p>
      </div>
    </div>
  </label>

  <div class="rm-details" id="rmPost">
    <div class="rm-card">
      <div class="rm-col">
        <h5>Your return will be posted to</h5>
        <p><strong>Returns Dept – C - Returns</strong><br>
          123 Example St, Melbourne VIC 3000</p>
      </div>
      <div class="rm-col">
        <h5>How it works</h5>
        <ul>
          <li>Submit this request</li>
          <li>After we approve the return, we email you a printable label</li>
          <li>Drop the parcel at any Post Office</li>
        </ul>
      </div>
    </div>
  </div>

  <!-- Option 2 -->
  <label class="rm-option" data-option="store">
    <input type="radio" name="returnMethod" value="store">
    <div class="rm-content">
      <div class="rm-title">
        <h4>Drop off at a store</h4>
        <p>Choose your nearest store and pick a visit date.</p>
      </div>
    </div>
  </label>

  <div class="rm-details" id="rmStore" hidden>
    <div class="rm-card">
      <div class="rm-col">
        <label for="storeSelect">Select store location</label>
        <select id="storeSelect" name="store">
          <option>Melbourne – 123 Example St</option>
          <option>Geelong – 5 Bay Rd</option>
          <option>Ballarat – 15 Main St</option>
        </select>
      </div>
      <div class="rm-col">
        <label for="visitDate">Choose visit date</label>
        <input type="date" id="visitDate" name="visitDate">
      </div>
    </div>
  </div>
</section>
</span>
</details>

  <summary>
    <!-- Submit -->
    <button type="submit" class="btn">Submit Return Request</button>
 </form>
  </main>
</div><!-- /layout -->

<div id="toast" class="toast"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

<script>
(() => {
  const btnPhone = document.getElementById('phoneUploadBtn');
  const modal = document.getElementById('qrModal');
  const qrBox = document.getElementById('qrBox');
  const linkInput = document.getElementById('qrLink');
  const codeText = document.getElementById('qrCodeText');
  const expiryEl = document.getElementById('qrExpiry');
  const closeBtn = document.getElementById('closeQrBtn');
  const copyBtn = document.getElementById('copyLinkBtn');

  let pollTimer = null;
  let countdownTimer = null;
  let session = null;

  // --- Demo fallback: make a local upload URL if backend not ready
  function makeLocalSession() {
    const code = Math.random().toString(36).slice(2, 8).toUpperCase();
    const url = `${location.origin}${location.pathname.replace(/[^/]+$/, '')}phone-upload.html?code=${code}`;
    const expiresAt = Date.now() + 5*60*1000; // 5 minutes
    return { code, url, expiresAt };
  }

  async function createSession() {
    try {
      // If you have an API, use it here:
      // const r = await fetch('/api/upload-sessions', { method:'POST' });
      // if (!r.ok) throw new Error('create failed');
      // return await r.json();

      // Fallback demo:
      return makeLocalSession();
    } catch(e) {
      console.error(e);
      return makeLocalSession();
    }
  }

  function openModal() {
    modal.classList.add('open');
    modal.setAttribute('aria-hidden','false');
  }
  function closeModal() {
    modal.classList.remove('open');
    modal.setAttribute('aria-hidden','true');
    clearInterval(pollTimer); pollTimer = null;
    clearInterval(countdownTimer); countdownTimer = null;
    qrBox.innerHTML = '';
  }

  function startCountdown(expiresAt){
    function tick(){
      const ms = Math.max(0, expiresAt - Date.now());
      const m = Math.floor(ms/60000), s = Math.floor((ms%60000)/1000);
      expiryEl.textContent = m ? `${m}m ${s}s` : `${s}s`;
      if (ms <= 0){ clearInterval(countdownTimer); }
    }
    tick();
    countdownTimer = setInterval(tick, 1000);
  }

  // Poll backend for newly uploaded files for this session code
  async function pollUploads(code){
    try{
      // Real API example:
      // const r = await fetch(`/api/upload-sessions/${code}/files`);
      // if (!r.ok) return;
      // const data = await r.json();

      // Demo: read from localStorage (phone-upload.html will write here)
      const raw = localStorage.getItem(`phone_upload_${code}`) || '[]';
      const data = { files: JSON.parse(raw) };

      if (Array.isArray(data.files) && data.files.length){
        // Integrate: push into your existing "files" array and re-render
        // CHANGE these two lines if your page uses different names:
        data.files.forEach(f => {
          files.push({ name: f.name, size: f.size, url: f.url }); // your file object shape
        });
        renderFileList(); // re-use your existing renderer

        // clear phone stash and stop polling
        localStorage.removeItem(`phone_upload_${code}`);
        closeModal();
      }
    }catch(e){ /* ignore transient errors */ }
  }

  btnPhone?.addEventListener('click', async () => {
    session = await createSession();

    // Render QR
    qrBox.innerHTML = '';
    new QRCode(qrBox, {
      text: session.url,
      width: 140,
      height: 140,
      correctLevel: QRCode.CorrectLevel.M
    });

    linkInput.value = session.url;
    codeText.textContent = session.code;
    startCountdown(session.expiresAt);
    openModal();

    // Start polling every 3s
    pollTimer = setInterval(() => pollUploads(session.code), 3000);
  });

  copyBtn?.addEventListener('click', () => {
    linkInput.select(); linkInput.setSelectionRange(0, 99999);
    document.execCommand('copy');
    copyBtn.textContent = 'Copied';
    setTimeout(()=> copyBtn.textContent = 'Copy', 1500);
  });

  closeBtn?.addEventListener('click', closeModal);
  modal?.addEventListener('click', (e)=> { if (e.target === modal) closeModal(); });
  
})();
</script>

<script>

  // Toast helper
  const toast=(msg)=>{
    const t=document.getElementById('toast');
    t.textContent=msg;
    t.classList.add('show');
    setTimeout(()=>t.classList.remove('show'),2000);
  };

  // Handle form submit
document.getElementById('returnForm').addEventListener('submit', e=>{
  e.preventDefault();
  toast("Your return request has been submitted!");

  // wait a moment so the toast is visible, then redirect
  setTimeout(()=>{
    window.location.href = "returns-thk.html"; // ✅ link to your Job Card page
  }, 1500);
});

// Stage 1 logic: adapt the form based on return type
const returnType = document.getElementById('returnType');
const faultTextarea = document.getElementById('fault');
const faultLabel = document.querySelector('label[for="fault"]');

function applyReturnType(v){
  if (v === 'faulty') {
    faultLabel.textContent = 'Describe the fault/problem';
    faultTextarea.placeholder = 'What happens, when, any codes/artifacts, tests tried…';
    faultTextarea.required = true; // keep it required for faulty
  } else if (v === 'other') {
    faultLabel.textContent = 'Tell us what you need';
    faultTextarea.placeholder = 'Change of mind, wrong item, refund/exchange request…';
    faultTextarea.required = true; // still required so we have context
  }
}

returnType.addEventListener('change', e => applyReturnType(e.target.value));
// initialize (in case browser auto-fills)
applyReturnType(returnType.value || '');



  // === Replace this block with a real API call when ready ===
  // Example:
  // const res = await fetch(`/api/serial-lookup?serial=${encodeURIComponent(key)}`);
  // const found = res.ok ? await res.json() : null;

// -------- Stage UI (Steps 1–4) --------
const stages = [...document.querySelectorAll('.stage')];
const s1 = stages[0], s2 = stages[1], s3 = stages[2], s4 = stages[3];
const s1Status = document.getElementById('s1Status');
const s2Status = document.getElementById('s2Status');
const s3Status = document.getElementById('s3Status');
const s4Status = document.getElementById('s4Status');

function setComplete(el){
  if (el) {
    el.textContent = 'Complete';
    el.style.color = '#047857';
  }
}

// Allow multiple stages to stay open if you want that behavior
function openOnly(el){
  el?.setAttribute('open','');   // open this one, DO NOT close others
}

// Let native <details> handle toggling; no forced accordion
document.querySelectorAll('.stage > summary').forEach(sum=>{
  sum.addEventListener('click', ()=>{ /* no-op */ });
});

// Step 1: when a choice is made
const returnTypeEl  = document.getElementById('returnType');
const returnWarning = document.getElementById('returnWarning');

function updateWarning(){
  if (!returnWarning) return;
  returnWarning.style.display = (returnTypeEl?.value === 'other') ? 'block' : 'none';
}

returnTypeEl?.addEventListener('change', () => {
  if (returnTypeEl.value){
    setComplete(s1Status);
    openOnly(s2);    // this just opens Step 2 (doesn't collapse others)
  }
  updateWarning();   // show/hide red terms text
});

// run once on load to reflect any pre-filled value
updateWarning();

returnTypeEl?.addEventListener('change', () => {
  // Mark step as complete if a selection exists
  if (returnTypeEl.value) {
    setComplete(s1Status);
    // Automatically open Step 2 (optional)
  openOnly(s2);
  }

(function returnTypeWarningInit(){
  const sel = document.getElementById('returnType');
  const warn = document.getElementById('returnWarning');
  if (!sel || !warn) return;

  function updateWarning() {
    // Make sure this matches the actual value of your “Something else” option
    warn.style.display = (sel.value === 'other') ? 'block' : 'none';
  }

  sel.addEventListener('change', updateWarning);
  // Also run once on load so it reflects any pre-filled value
  updateWarning();
})();


// Step 2: complete when Product & SKU are present (manual or auto-filled)
const productEl = document.getElementById('product');
const skuEl     = document.getElementById('sku');
function checkStep2Complete(){
  if (productEl?.value.trim() && skuEl?.value.trim()){
    setComplete(s2Status);
    openOnly(s3);
  } else if (s2Status){ s2Status.textContent='Waiting'; s2Status.style.color='var(--muted)'; }
}
productEl?.addEventListener('input', checkStep2Complete);
skuEl?.addEventListener('input', checkStep2Complete);

// Step 3: complete when fault text OR at least one file
const faultEl = document.getElementById('fault');
let filesCount = 0;
function updateS3(){
  const ok = !!faultEl?.value.trim() || filesCount > 0;
  if (ok){ setComplete(s3Status); openOnly(s4); }
  else if (s3Status){ s3Status.textContent='Required'; s3Status.style.color='var(--muted)'; }
}
faultEl?.addEventListener('input', updateS3);

// hook into your existing renderFileList() to update filesCount
const _renderFileList = window.renderFileList;
window.renderFileList = function(){
  if (typeof _renderFileList === 'function') _renderFileList();
  try { filesCount = Array.isArray(files) ? files.length : 0; } catch { filesCount = 0; }
  updateS3();
};

// Step 4: complete when Name + valid Email
const nameEl  = document.getElementById('name');
const emailEl = document.getElementById('email');
const validEmail = v => /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(v||'');
function updateS4(){
  const ok = !!nameEl?.value.trim() && validEmail(emailEl?.value);
  if (ok){ setComplete(s4Status); }
  else if (s4Status){ s4Status.textContent='Required'; s4Status.style.color='var(--muted)'; }
}
nameEl?.addEventListener('input', updateS4);
emailEl?.addEventListener('input', updateS4);

});

// Sidebar navigation (optional)
document.querySelectorAll('.sb-item').forEach(btn=>{
  btn.addEventListener('click', ()=>{
    const href = btn.dataset.link;
    if (href) window.location.href = href; // replace with router push if needed
  });
}); // <-- this closes the forEach

document.addEventListener('DOMContentLoaded', () => {
  const returnsBtn = document.querySelector('.sb-returns');
  if (returnsBtn) {
    returnsBtn.addEventListener('click', () => {
      window.location.href = 'Returns-landing.html';
    });
  }
});

(function(){
// Hook into your drop zone (click & drag-drop)
const drop = document.getElementById('drop')               // add this first
        || document.getElementById('attachDrop')
        || document.getElementById('dropZone')
        || document.querySelector('[data-drop="attachments"]');

  function addFiles(list){
    window.UPLOADS = window.UPLOADS || [];
    const STORE = window.UPLOADS;
    const grid  = document.getElementById('uploadedGrid');
    const count = document.getElementById('upCount');

    [...list].forEach(file=>{
      const url = URL.createObjectURL(file);
      STORE.push({ name:file.name, type:file.type, size:file.size, url, objectURL:true });
    });

    // render
    if (grid) {
      grid.innerHTML = STORE.map((f,i)=>{
        const isImg = (f.type||'').startsWith('image/');
        return `
          <div class="up-card">
            <a class="up-preview" href="${f.url}" target="_blank" rel="noopener">
              ${isImg ? `<img src="${f.url}" alt="">` : `<span style="font-weight:900">${(f.type||'FILE').split('/').pop().toUpperCase()}</span>`}
            </a>
            <div class="up-meta">
              <div class="up-name" title="${f.name}">${f.name}</div>
              <div class="up-actions">
                <button class="icon-btn" data-i="${i}" data-act="download">⭳</button>
                <button class="icon-btn" data-i="${i}" data-act="remove">✕</button>
              </div>
            </div>
          </div>`;
      }).join('');
    }
    if (count) count.textContent = `(${STORE.length})`;
  }

  // Hook file input(s)
  document.querySelectorAll('input[type="file"][data-attachments], #attachmentsInput')
    .forEach(input=>{
      input.addEventListener('change', ()=> addFiles(input.files));
    });

  // Hook dropzone
  if (drop){
    ;['dragenter','dragover'].forEach(ev=> drop.addEventListener(ev, e=>{ e.preventDefault(); }));
    drop.addEventListener('drop', (e)=>{
      e.preventDefault();
      addFiles(e.dataTransfer.files);
      // Clear any text/links your old code might have added under the dropzone:
      drop.querySelectorAll('a, li, .file-pill, .file-name').forEach(n=> n.remove());
    });
    // Clicking the drop opens a file picker that also routes to addFiles
    drop.addEventListener('click', ()=>{
      const i=document.createElement('input'); i.type='file'; i.multiple=true;
      i.accept='image/*,video/*,application/pdf';
      i.onchange=()=> addFiles(i.files);
      i.click();
    });
  }

  // Handle remove/download actions
  document.getElementById('uploadedGrid')?.addEventListener('click',(e)=>{
    const btn = e.target.closest('.icon-btn'); if(!btn) return;
    const i   = +btn.dataset.i; const act = btn.dataset.act;
    const STORE = window.UPLOADS||[];
    const f = STORE[i]; if(!f) return;

    if (act==='remove'){ try{ f.objectURL && URL.revokeObjectURL(f.url); }catch{} STORE.splice(i,1); addFiles([]); }
    if (act==='download'){ const a=document.createElement('a'); a.href=f.url; a.download=f.name||'file'; document.body.appendChild(a); a.click(); a.remove(); }
  });
})();

const fault = document.getElementById('fault');
fault.addEventListener('input', e => {
  e.target.style.height = 'auto';
  e.target.style.height = e.target.scrollHeight + 'px';
});

const radios = document.querySelectorAll('input[name="returnMethod"]');
const postBlk = document.getElementById('rmPost');
const storeBlk = document.getElementById('rmStore');

function applySelection() {
  document.querySelectorAll('.rm-option').forEach(l => l.classList.remove('is-selected'));
  const chosen = document.querySelector(`.rm-option input:checked`)?.closest('.rm-option');
  if (chosen) chosen.classList.add('is-selected');

  const val = document.querySelector('input[name="returnMethod"]:checked')?.value;
  postBlk.hidden  = val !== 'post';
  storeBlk.hidden = val !== 'store';
}
radios.forEach(r => r.addEventListener('change', applySelection));
applySelection();

</script>
</body>
</html>